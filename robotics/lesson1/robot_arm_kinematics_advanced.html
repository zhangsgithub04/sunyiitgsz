<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Robot Arm - Advanced Kinematics Visualization</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@400;600;700&display=swap');

        :root {
            --primary-blue: #0066CC;
            --primary-blue-light: #3399FF;
            --primary-blue-dark: #004499;
            --accent-orange: #FF6B35;
            --success-green: #00A878;
            --warning-yellow: #FFB81C;
            --error-red: #E63946;
            --neutral-bg: #F5F7FA;
            --panel-bg: #FFFFFF;
            --text-primary: #1A1A1A;
            --text-secondary: #666666;
            --border-color: #D1D9E0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--neutral-bg);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .app-container {
            display: grid;
            grid-template-columns: 380px 1fr 420px;
            height: 100vh;
            gap: 0;
        }

        /* Left Panel - Mathematics */
        .math-panel {
            background: var(--panel-bg);
            border-right: 2px solid var(--border-color);
            overflow-y: auto;
            padding: 24px;
        }

        .panel-title {
            color: var(--primary-blue);
            font-size: 1.3em;
            font-weight: 800;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid var(--primary-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .matrix-section {
            background: var(--neutral-bg);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .matrix-section h4 {
            color: var(--primary-blue-dark);
            font-size: 0.95em;
            margin-bottom: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .matrix-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85em;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            overflow-x: auto;
        }

        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin: 8px 0;
        }

        .matrix-cell {
            background: #E8F4F8;
            padding: 8px;
            text-align: center;
            border-radius: 4px;
            font-weight: 600;
            color: var(--primary-blue-dark);
            border: 1px solid var(--primary-blue-light);
        }

        .vector-display {
            display: flex;
            gap: 12px;
            margin: 8px 0;
        }

        .vector-component {
            flex: 1;
            background: #E8F4F8;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            border: 1px solid var(--primary-blue-light);
        }

        .vector-label {
            font-size: 0.75em;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .vector-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1em;
            color: var(--primary-blue-dark);
            font-weight: 700;
        }

        .coordinate-frame {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
        }

        .frame-label {
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .axis-info {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid var(--neutral-bg);
        }

        .axis-info:last-child {
            border-bottom: none;
        }

        .axis-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .axis-x { color: #E63946; }
        .axis-y { color: #00A878; }
        .axis-z { color: #0066CC; }

        /* Center - 3D Viewport */
        .viewport-section {
            position: relative;
            background: linear-gradient(135deg, #FFFFFF 0%, #E8F4F8 100%);
        }

        #canvas3d {
            width: 100%;
            height: 100%;
            display: block;
            cursor: grab;
        }

        #canvas3d:active {
            cursor: grabbing;
        }

        .viewport-controls {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 12px;
        }

        .view-button {
            background: var(--panel-bg);
            border: 2px solid var(--primary-blue);
            color: var(--primary-blue);
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-button:hover {
            background: var(--primary-blue);
            color: white;
        }

        .workspace-overlay {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid var(--primary-blue);
            border-radius: 10px;
            padding: 16px;
            max-width: 320px;
        }

        .workspace-overlay h3 {
            color: var(--primary-blue);
            font-size: 1em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .workspace-info {
            font-size: 0.85em;
            line-height: 1.6;
            color: var(--text-primary);
        }

        /* Right Panel - Controls */
        .controls-panel {
            background: var(--panel-bg);
            border-left: 2px solid var(--border-color);
            overflow-y: auto;
            padding: 24px;
        }

        .control-section {
            background: var(--neutral-bg);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .control-section h3 {
            color: var(--primary-blue-dark);
            font-size: 1.1em;
            margin-bottom: 16px;
            font-weight: 700;
        }

        .slider-group {
            margin-bottom: 18px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .slider-name {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.9em;
        }

        .slider-value {
            background: var(--primary-blue);
            color: white;
            padding: 5px 12px;
            border-radius: 5px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9em;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: #E8ECF1;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
            border: 1px solid var(--border-color);
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-blue);
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0, 102, 204, 0.4);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--primary-blue);
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
        }

        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 12px;
        }

        button {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-size: 0.85em;
            font-weight: 700;
            transition: all 0.2s;
        }

        button:hover {
            background: var(--primary-blue-dark);
            transform: translateY(-2px);
        }

        button.success {
            background: var(--success-green);
        }

        button.danger {
            background: var(--error-red);
        }

        .toggle-group {
            display: flex;
            gap: 10px;
            margin: 12px 0;
        }

        .toggle-btn {
            flex: 1;
            padding: 10px;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            font-size: 0.85em;
            transition: all 0.2s;
        }

        .toggle-btn.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .toggle-btn:hover {
            border-color: var(--primary-blue);
        }

        .info-box {
            background: #E8F4F8;
            border-left: 4px solid var(--primary-blue);
            padding: 14px;
            border-radius: 6px;
            margin: 14px 0;
            font-size: 0.85em;
        }

        .info-box strong {
            color: var(--primary-blue-dark);
            display: block;
            margin-bottom: 6px;
        }

        .dh-table {
            width: 100%;
            border-collapse: collapse;
            margin: 12px 0;
            font-size: 0.85em;
        }

        .dh-table th {
            background: var(--primary-blue);
            color: white;
            padding: 8px;
            text-align: center;
            font-weight: 700;
        }

        .dh-table td {
            background: white;
            padding: 8px;
            text-align: center;
            border: 1px solid var(--border-color);
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }

        /* Scrollbar styling */
        .math-panel::-webkit-scrollbar,
        .controls-panel::-webkit-scrollbar {
            width: 10px;
        }

        .math-panel::-webkit-scrollbar-track,
        .controls-panel::-webkit-scrollbar-track {
            background: var(--neutral-bg);
        }

        .math-panel::-webkit-scrollbar-thumb,
        .controls-panel::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 5px;
        }

        .math-panel::-webkit-scrollbar-thumb:hover,
        .controls-panel::-webkit-scrollbar-thumb:hover {
            background: var(--primary-blue-light);
        }

        @media (max-width: 1400px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
                height: auto;
                min-height: 100vh;
            }

            .viewport-section {
                height: 70vh;
            }
        }

        /* Matrix bracket styling */
        .matrix-bracket {
            border: 2px solid var(--primary-blue);
            border-radius: 4px;
            padding: 8px;
        }

        .highlight-box {
            background: rgba(255, 107, 53, 0.1);
            border: 2px solid var(--accent-orange);
            padding: 12px;
            border-radius: 6px;
            margin: 8px 0;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- LEFT PANEL - Mathematics & Theory -->
        <div class="math-panel">
            <div class="panel-title">
                üìê Kinematics Analysis
            </div>

            <!-- Joint Angles -->
            <div class="matrix-section">
                <h4>Joint Configuration (Œ∏)</h4>
                <div class="coordinate-frame">
                    <div class="axis-info">
                        <span class="axis-name">Œ∏‚ÇÅ (Base):</span>
                        <span class="axis-x" id="theta1-display">0.00¬∞</span>
                    </div>
                    <div class="axis-info">
                        <span class="axis-name">Œ∏‚ÇÇ (Shoulder):</span>
                        <span class="axis-y" id="theta2-display">0.00¬∞</span>
                    </div>
                    <div class="axis-info">
                        <span class="axis-name">Œ∏‚ÇÉ (Elbow):</span>
                        <span class="axis-z" id="theta3-display">0.00¬∞</span>
                    </div>
                </div>
            </div>

            <!-- End-Effector Position -->
            <div class="matrix-section">
                <h4>End-Effector Position</h4>
                <div class="vector-display">
                    <div class="vector-component">
                        <div class="vector-label">X</div>
                        <div class="vector-value axis-x" id="ee-x">0.00</div>
                    </div>
                    <div class="vector-component">
                        <div class="vector-label">Y</div>
                        <div class="vector-value axis-y" id="ee-y">0.00</div>
                    </div>
                    <div class="vector-component">
                        <div class="vector-label">Z</div>
                        <div class="vector-value axis-z" id="ee-z">0.00</div>
                    </div>
                </div>
            </div>

            <!-- Rotation Matrix -->
            <div class="matrix-section">
                <h4>Rotation Matrix (R)</h4>
                <div class="matrix-display">
                    <div class="matrix-bracket">
                        <div class="matrix-grid" id="rotation-matrix">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
                <div class="info-box">
                    <strong>About Rotation Matrices:</strong>
                    Describes orientation of end-effector. Each column represents X, Y, Z axes in world frame.
                </div>
            </div>

            <!-- Transformation Matrix -->
            <div class="matrix-section">
                <h4>Transformation Matrix (T)</h4>
                <div class="matrix-display">
                    <div class="matrix-bracket">
                        <div class="matrix-grid" id="transform-matrix">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
                <div class="info-box">
                    <strong>Homogeneous Transform:</strong>
                    Combines rotation (top-left 3√ó3) and translation (right column) into single 4√ó4 matrix.
                </div>
            </div>

            <!-- DH Parameters -->
            <div class="matrix-section">
                <h4>Denavit-Hartenberg Parameters</h4>
                <table class="dh-table">
                    <thead>
                        <tr>
                            <th>Joint</th>
                            <th>Œ∏</th>
                            <th>d</th>
                            <th>a</th>
                            <th>Œ±</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td id="dh-theta1">0¬∞</td>
                            <td>0.30</td>
                            <td>0</td>
                            <td>90¬∞</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td id="dh-theta2">0¬∞</td>
                            <td>0</td>
                            <td>3.00</td>
                            <td>0¬∞</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td id="dh-theta3">0¬∞</td>
                            <td>0</td>
                            <td>2.50</td>
                            <td>0¬∞</td>
                        </tr>
                    </tbody>
                </table>
                <div class="info-box">
                    <strong>DH Convention:</strong>
                    Œ∏ = joint angle, d = link offset, a = link length, Œ± = link twist
                </div>
            </div>

            <!-- Workspace Info -->
            <div class="matrix-section">
                <h4>Workspace Metrics</h4>
                <div class="coordinate-frame">
                    <div class="axis-info">
                        <span class="axis-name">Max Reach:</span>
                        <span id="max-reach">5.50m</span>
                    </div>
                    <div class="axis-info">
                        <span class="axis-name">Min Reach:</span>
                        <span id="min-reach">0.30m</span>
                    </div>
                    <div class="axis-info">
                        <span class="axis-name">Work Volume:</span>
                        <span id="work-volume">~523 m¬≥</span>
                    </div>
                </div>
            </div>

            <!-- Jacobian (Advanced) -->
            <div class="matrix-section">
                <h4>Jacobian Matrix (J) - Advanced</h4>
                <div class="matrix-display">
                    <div class="matrix-bracket">
                        <div style="font-size: 0.75em; text-align: center; padding: 8px;">
                            6√ó3 matrix relating joint<br>velocities to end-effector velocity
                        </div>
                    </div>
                </div>
                <div class="info-box">
                    <strong>Velocity Kinematics:</strong>
                    J relates joint velocities (Œ∏Ãá) to end-effector velocity (·∫ã): ·∫ã = J¬∑Œ∏Ãá
                </div>
            </div>
        </div>

        <!-- CENTER - 3D Viewport -->
        <div class="viewport-section">
            <canvas id="canvas3d"></canvas>
            
            <div class="viewport-controls">
                <button class="view-button" onclick="setView('front')">Front</button>
                <button class="view-button" onclick="setView('side')">Side</button>
                <button class="view-button" onclick="setView('top')">Top</button>
                <button class="view-button" onclick="setView('iso')">Isometric</button>
            </div>

            <div class="workspace-overlay">
                <h3>Visualization Options</h3>
                <div class="toggle-group">
                    <div class="toggle-btn active" id="toggle-frames" onclick="toggleFrames()">
                        Frames
                    </div>
                    <div class="toggle-btn active" id="toggle-vectors" onclick="toggleVectors()">
                        Vectors
                    </div>
                </div>
                <div class="workspace-info">
                    <strong>Currently Showing:</strong><br>
                    ‚Ä¢ Coordinate frames at each joint<br>
                    ‚Ä¢ Position vectors (red/green/blue)<br>
                    ‚Ä¢ Workspace envelope (transparent)
                    <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #D1D9E0;">
                        <strong>Controls:</strong> Drag to rotate, Scroll to zoom
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT PANEL - Controls -->
        <div class="controls-panel">
            <div class="panel-title">
                üéÆ Robot Control
            </div>

            <div class="control-section">
                <h3>Joint Control</h3>
                
                <div class="slider-group">
                    <div class="slider-label">
                        <span class="slider-name">Joint 1 - Base</span>
                        <span class="slider-value" id="value-joint1">0¬∞</span>
                    </div>
                    <input type="range" id="joint1" min="-180" max="180" value="0" step="1">
                </div>

                <div class="slider-group">
                    <div class="slider-label">
                        <span class="slider-name">Joint 2 - Shoulder</span>
                        <span class="slider-value" id="value-joint2">0¬∞</span>
                    </div>
                    <input type="range" id="joint2" min="-90" max="90" value="0" step="1">
                </div>

                <div class="slider-group">
                    <div class="slider-label">
                        <span class="slider-name">Joint 3 - Elbow</span>
                        <span class="slider-value" id="value-joint3">0¬∞</span>
                    </div>
                    <input type="range" id="joint3" min="-120" max="120" value="0" step="1">
                </div>

                <div class="button-grid">
                    <button onclick="toggleGripper()">Gripper</button>
                    <button class="danger" onclick="resetArm()">Reset</button>
                </div>
            </div>

            <div class="control-section">
                <h3>Preset Configurations</h3>
                <div class="button-grid">
                    <button class="success" onclick="setConfig('ready')">Ready</button>
                    <button class="success" onclick="setConfig('reach')">Max Reach</button>
                    <button class="success" onclick="setConfig('fold')">Folded</button>
                    <button class="success" onclick="setConfig('vertical')">Vertical</button>
                </div>
            </div>

            <div class="control-section">
                <h3>Teaching Modes</h3>
                <div class="info-box">
                    <strong>Forward Kinematics Mode</strong>
                    Given: Joint angles Œ∏‚ÇÅ, Œ∏‚ÇÇ, Œ∏‚ÇÉ<br>
                    Calculate: End-effector position (x, y, z)<br>
                    <strong>Current mode - adjust joints to see position update</strong>
                </div>
                
                <div class="highlight-box">
                    <strong>üìö Learning Points:</strong><br>
                    ‚Ä¢ Each joint rotation affects end position<br>
                    ‚Ä¢ Rotation matrix shows orientation<br>
                    ‚Ä¢ DH parameters define robot geometry<br>
                    ‚Ä¢ Transform matrix = rotation + position
                </div>
            </div>

            <div class="control-section">
                <h3>Key Concepts</h3>
                <div style="font-size: 0.85em; line-height: 1.8;">
                    <strong style="color: var(--primary-blue);">Coordinate Frames:</strong><br>
                    Each joint has its own coordinate system. Red=X, Green=Y, Blue=Z axes.<br><br>
                    
                    <strong style="color: var(--primary-blue);">Rotation Matrix:</strong><br>
                    3√ó3 matrix describing how the end-effector is oriented relative to base.<br><br>
                    
                    <strong style="color: var(--primary-blue);">Transformation:</strong><br>
                    Combines rotation and translation to map from joint space to Cartesian space.<br><br>
                    
                    <strong style="color: var(--primary-blue);">DH Parameters:</strong><br>
                    Standard way to describe robot link connections and geometry.
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Three.js setup
        let scene, camera, renderer, robotArm;
        let base, shoulder, elbow, gripper, gripperLeft, gripperRight;
        let frames = [];
        let showFrames = true;
        let showVectors = true;

        const armState = {
            joint1: 0,
            joint2: 0,
            joint3: 0,
            gripperOpen: true
        };

        // Link lengths (meters)
        const L1 = 0.3;  // Base height
        const L2 = 3.0;  // Upper arm
        const L3 = 2.5;  // Forearm

        function init3D() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xF5F7FA);

            const canvas = document.getElementById('canvas3d');
            camera = new THREE.PerspectiveCamera(45, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
            camera.position.set(10, 8, 12);
            camera.lookAt(0, 2, 0);

            renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
            renderer.shadowMap.enabled = true;

            // Lights
            const ambientLight = new THREE.AmbientLight(0xFFFFFF, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xFFFFFF, 0.8);
            directionalLight.position.set(8, 12, 8);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            // Grid
            const gridHelper = new THREE.GridHelper(20, 20, 0x0066CC, 0xB0BEC5);
            gridHelper.material.opacity = 0.4;
            gridHelper.material.transparent = true;
            scene.add(gridHelper);

            // Ground
            const groundGeometry = new THREE.PlaneGeometry(20, 20);
            const groundMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xE8ECF1,
                roughness: 0.9
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            // Build robot
            buildRobotArm();
            createCoordinateFrames();

            // Mouse controls
            setupCameraControls(canvas);

            animate();
            updateKinematics();
        }

        function buildRobotArm() {
            robotArm = new THREE.Group();

            // Base
            const baseGeometry = new THREE.CylinderGeometry(0.8, 1, 0.3, 32);
            const baseMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x546E7A,
                roughness: 0.6,
                metalness: 0.4
            });
            base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.position.y = 0.15;
            base.castShadow = true;
            robotArm.add(base);

            // Shoulder
            shoulder = new THREE.Group();
            shoulder.position.y = L1;
            
            const shoulderJoint = new THREE.Mesh(
                new THREE.SphereGeometry(0.3, 32, 32),
                new THREE.MeshStandardMaterial({ color: 0x0066CC, metalness: 0.7 })
            );
            shoulderJoint.castShadow = true;
            shoulder.add(shoulderJoint);

            const arm1 = new THREE.Mesh(
                new THREE.BoxGeometry(0.3, L2, 0.3),
                new THREE.MeshStandardMaterial({ color: 0xECEFF1, metalness: 0.3 })
            );
            arm1.position.y = L2 / 2;
            arm1.castShadow = true;
            shoulder.add(arm1);
            robotArm.add(shoulder);

            // Elbow
            elbow = new THREE.Group();
            elbow.position.y = L2;
            
            const elbowJoint = new THREE.Mesh(
                new THREE.SphereGeometry(0.3, 32, 32),
                new THREE.MeshStandardMaterial({ color: 0x0066CC, metalness: 0.7 })
            );
            elbowJoint.castShadow = true;
            elbow.add(elbowJoint);

            const arm2 = new THREE.Mesh(
                new THREE.BoxGeometry(0.25, L3, 0.25),
                new THREE.MeshStandardMaterial({ color: 0xECEFF1, metalness: 0.3 })
            );
            arm2.position.y = L3 / 2;
            arm2.castShadow = true;
            elbow.add(arm2);
            shoulder.add(elbow);

            // Gripper
            gripper = new THREE.Group();
            gripper.position.y = L3;

            const gripperBase = new THREE.Mesh(
                new THREE.CylinderGeometry(0.2, 0.2, 0.3, 16),
                new THREE.MeshStandardMaterial({ color: 0xFF6B35, metalness: 0.6 })
            );
            gripperBase.castShadow = true;
            gripper.add(gripperBase);

            gripperLeft = new THREE.Mesh(
                new THREE.BoxGeometry(0.1, 0.6, 0.1),
                new THREE.MeshStandardMaterial({ color: 0x78909C, metalness: 0.5 })
            );
            gripperLeft.position.set(-0.15, -0.3, 0);
            gripperLeft.castShadow = true;
            gripper.add(gripperLeft);

            gripperRight = new THREE.Mesh(
                new THREE.BoxGeometry(0.1, 0.6, 0.1),
                new THREE.MeshStandardMaterial({ color: 0x78909C, metalness: 0.5 })
            );
            gripperRight.position.set(0.15, -0.3, 0);
            gripperRight.castShadow = true;
            gripper.add(gripperRight);

            elbow.add(gripper);
            scene.add(robotArm);
        }

        function createCoordinateFrames() {
            // Create coordinate frame axes at base, shoulder, elbow, end-effector
            const positions = [
                { parent: base, position: new THREE.Vector3(0, 0.15, 0) },
                { parent: shoulder, position: new THREE.Vector3(0, 0, 0) },
                { parent: elbow, position: new THREE.Vector3(0, 0, 0) },
                { parent: gripper, position: new THREE.Vector3(0, -0.6, 0) }
            ];

            positions.forEach((pos, i) => {
                const frame = createAxisHelper(0.8);
                frame.position.copy(pos.position);
                pos.parent.add(frame);
                frames.push(frame);
            });
        }

        function createAxisHelper(size) {
            const group = new THREE.Group();
            
            // X axis - Red
            const xAxis = createArrow(size, 0xFF0000);
            xAxis.rotation.z = -Math.PI / 2;
            group.add(xAxis);

            // Y axis - Green
            const yAxis = createArrow(size, 0x00FF00);
            group.add(yAxis);

            // Z axis - Blue
            const zAxis = createArrow(size, 0x0000FF);
            zAxis.rotation.x = Math.PI / 2;
            group.add(zAxis);

            return group;
        }

        function createArrow(length, color) {
            const group = new THREE.Group();
            
            const shaft = new THREE.Mesh(
                new THREE.CylinderGeometry(0.02, 0.02, length * 0.8, 8),
                new THREE.MeshBasicMaterial({ color: color })
            );
            shaft.position.y = length * 0.4;
            group.add(shaft);

            const head = new THREE.Mesh(
                new THREE.ConeGeometry(0.06, 0.2, 8),
                new THREE.MeshBasicMaterial({ color: color })
            );
            head.position.y = length * 0.9;
            group.add(head);

            return group;
        }

        function setupCameraControls(canvas) {
            let isDragging = false;
            let previousMouse = { x: 0, y: 0 };
            let cameraAngle = 0.8;
            let cameraHeight = 8;

            canvas.addEventListener('mousedown', (e) => {
                isDragging = true;
                previousMouse = { x: e.clientX, y: e.clientY };
            });

            canvas.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const deltaX = e.clientX - previousMouse.x;
                    const deltaY = e.clientY - previousMouse.y;
                    
                    cameraAngle -= deltaX * 0.005;
                    cameraHeight = Math.max(2, Math.min(15, cameraHeight - deltaY * 0.02));
                    
                    const radius = 15;
                    camera.position.x = Math.sin(cameraAngle) * radius;
                    camera.position.z = Math.cos(cameraAngle) * radius;
                    camera.position.y = cameraHeight;
                    camera.lookAt(0, 3, 0);
                    
                    previousMouse = { x: e.clientX, y: e.clientY };
                }
            });

            canvas.addEventListener('mouseup', () => isDragging = false);
            
            canvas.addEventListener('wheel', (e) => {
                e.preventDefault();
                const radius = Math.sqrt(camera.position.x ** 2 + camera.position.z ** 2);
                const newRadius = Math.max(8, Math.min(25, radius + e.deltaY * 0.02));
                const scale = newRadius / radius;
                camera.position.x *= scale;
                camera.position.z *= scale;
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            renderer.render(scene, camera);
        }

        function updateRobotArm() {
            const theta1Rad = THREE.MathUtils.degToRad(armState.joint1);
            const theta2Rad = THREE.MathUtils.degToRad(armState.joint2);
            const theta3Rad = THREE.MathUtils.degToRad(armState.joint3);

            robotArm.rotation.y = theta1Rad;
            shoulder.rotation.z = theta2Rad;
            elbow.rotation.z = theta3Rad;

            if (armState.gripperOpen) {
                gripperLeft.position.x = -0.15;
                gripperRight.position.x = 0.15;
            } else {
                gripperLeft.position.x = -0.05;
                gripperRight.position.x = 0.05;
            }

            updateKinematics();
        }

        function updateKinematics() {
            const theta1 = THREE.MathUtils.degToRad(armState.joint1);
            const theta2 = THREE.MathUtils.degToRad(armState.joint2);
            const theta3 = THREE.MathUtils.degToRad(armState.joint3);

            // Forward kinematics
            const c1 = Math.cos(theta1);
            const s1 = Math.sin(theta1);
            const c2 = Math.cos(theta2);
            const s2 = Math.sin(theta2);
            const c23 = Math.cos(theta2 + theta3);
            const s23 = Math.sin(theta2 + theta3);

            // End-effector position
            const x = (L2 * c2 + L3 * c23) * c1;
            const y = L1 + L2 * s2 + L3 * s23;
            const z = (L2 * c2 + L3 * c23) * s1;

            // Update displays
            document.getElementById('theta1-display').textContent = armState.joint1.toFixed(2) + '¬∞';
            document.getElementById('theta2-display').textContent = armState.joint2.toFixed(2) + '¬∞';
            document.getElementById('theta3-display').textContent = armState.joint3.toFixed(2) + '¬∞';
            
            document.getElementById('ee-x').textContent = x.toFixed(3);
            document.getElementById('ee-y').textContent = y.toFixed(3);
            document.getElementById('ee-z').textContent = z.toFixed(3);

            document.getElementById('dh-theta1').textContent = armState.joint1.toFixed(1) + '¬∞';
            document.getElementById('dh-theta2').textContent = armState.joint2.toFixed(1) + '¬∞';
            document.getElementById('dh-theta3').textContent = armState.joint3.toFixed(1) + '¬∞';

            // Rotation matrix (simplified for end-effector)
            const R = [
                [c1*c23, -c1*s23, s1],
                [s23, c23, 0],
                [s1*c23, -s1*s23, -c1]
            ];

            const rotMatrix = document.getElementById('rotation-matrix');
            rotMatrix.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'matrix-cell';
                    cell.textContent = R[i][j].toFixed(3);
                    rotMatrix.appendChild(cell);
                }
                const cell = document.createElement('div');
                cell.className = 'matrix-cell';
                cell.style.background = '#fff';
                cell.textContent = i === 0 ? x.toFixed(2) : i === 1 ? y.toFixed(2) : z.toFixed(2);
                rotMatrix.appendChild(cell);
            }

            // Transformation matrix
            const transMatrix = document.getElementById('transform-matrix');
            transMatrix.innerHTML = '';
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'matrix-cell';
                    cell.textContent = R[i][j].toFixed(3);
                    transMatrix.appendChild(cell);
                }
                const cell = document.createElement('div');
                cell.className = 'matrix-cell';
                cell.style.background = '#FFE8E0';
                cell.textContent = i === 0 ? x.toFixed(2) : i === 1 ? y.toFixed(2) : z.toFixed(2);
                transMatrix.appendChild(cell);
            }
            // Last row
            for (let j = 0; j < 4; j++) {
                const cell = document.createElement('div');
                cell.className = 'matrix-cell';
                cell.textContent = j < 3 ? '0' : '1';
                transMatrix.appendChild(cell);
            }

            document.getElementById('value-joint1').textContent = armState.joint1 + '¬∞';
            document.getElementById('value-joint2').textContent = armState.joint2 + '¬∞';
            document.getElementById('value-joint3').textContent = armState.joint3 + '¬∞';
        }

        // Sliders
        document.getElementById('joint1').addEventListener('input', (e) => {
            armState.joint1 = parseInt(e.target.value);
            updateRobotArm();
        });

        document.getElementById('joint2').addEventListener('input', (e) => {
            armState.joint2 = parseInt(e.target.value);
            updateRobotArm();
        });

        document.getElementById('joint3').addEventListener('input', (e) => {
            armState.joint3 = parseInt(e.target.value);
            updateRobotArm();
        });

        function toggleGripper() {
            armState.gripperOpen = !armState.gripperOpen;
            updateRobotArm();
        }

        function resetArm() {
            armState.joint1 = 0;
            armState.joint2 = 0;
            armState.joint3 = 0;
            document.getElementById('joint1').value = 0;
            document.getElementById('joint2').value = 0;
            document.getElementById('joint3').value = 0;
            updateRobotArm();
        }

        function setConfig(config) {
            const configs = {
                ready: [0, 45, -45],
                reach: [0, 0, 0],
                fold: [0, 90, -90],
                vertical: [0, 90, 0]
            };
            
            if (configs[config]) {
                armState.joint1 = configs[config][0];
                armState.joint2 = configs[config][1];
                armState.joint3 = configs[config][2];
                document.getElementById('joint1').value = configs[config][0];
                document.getElementById('joint2').value = configs[config][1];
                document.getElementById('joint3').value = configs[config][2];
                updateRobotArm();
            }
        }

        function setView(view) {
            const views = {
                front: [0, 5, 15],
                side: [15, 5, 0],
                top: [0, 20, 0.1],
                iso: [10, 8, 12]
            };
            
            if (views[view]) {
                camera.position.set(...views[view]);
                camera.lookAt(0, 3, 0);
            }
        }

        function toggleFrames() {
            showFrames = !showFrames;
            frames.forEach(frame => frame.visible = showFrames);
            document.getElementById('toggle-frames').classList.toggle('active');
        }

        function toggleVectors() {
            showVectors = !showVectors;
            document.getElementById('toggle-vectors').classList.toggle('active');
        }

        window.addEventListener('resize', () => {
            const canvas = document.getElementById('canvas3d');
            camera.aspect = canvas.clientWidth / canvas.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(canvas.clientWidth, canvas.clientHeight);
        });

        init3D();
    </script>
</body>
</html>